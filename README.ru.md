# Welcome to the OpenCV-MinGW-Qt-install wiki!
Сборка OpenCV вызвала у меня кучу проблем. И пока всё свежо в памяти буду записывать. Потом переведу на английский.

Забавно, что по сборке OpenCV написано невероятное количество инструкций, и все они по той или иной причине не сработали.

Разберёмся с тем, что у нас есть

1. Qt+mingw. Всё скачано и установлено одним комплектом. В моём случае Qt5.4 в папке c:/qt
2. CMake. Я скачал архив и распаковал в папку c:/qt. Хотя это могла быть любая другая папка
3. OpenCV

На пункте OpenCV задержимся. Уже в процессе я столкнулся с тем, что разные версии несовместимы друг с другом и примеры приведённые в документации не работают на версии 3.0.0. И именно эта версия вызвала наибольшее количество проблем.

Другой момент, если хотите сэкономить сотню мегабайт на загрузке скачивайте архив для, внимание, Linux. Собственно, этот архив содержит то, что лежит в папке source для пакета под Windows. Но если вы планируете использовать OpenCV и под MSVC, то в пакете под Windows в папке build лежат уже скомпилированные библиотеки.

Куда распаковать архив не имеет значения, пусть на каком-нибудь диске, и пусть путь покороче.

## Параметры компилятора

Ищите в распакованном архиве opencv3.0.0 в исходниках `\cmake\OpenCVCompilerOptions.cmake`. В нём надо закомментировать дополнительные настройки компилятора `-Werror=non-virtual-dtor`. В строке 67 должно получиться

    #add_extra_compiler_option(-Werror=non-virtual-dtor)

## Пути

Большинство, да что там - все инструкции по установке предлагают в PATH записать пути до qt и mingw. Это вовсе не требуется и портить переменные среды - это как-то не красиво. Вспомним, что при установке Qt в Пуск-Все программы- Qt... можно обнаружить запуск консоли: в моём случае "Qt 5.4 for Desktop (MinGW 4.9 32 bit)". Нужен запуск от имени администратора (контекстное меню вторая строчка). Консоль открыта?

## Сборка OpenCV 3.0.0
1. Запустить из консоли C:\Qt\cmake-3.2.3-win32-x86\bin\cmake-gui.exe. Для любителей мышки рекомендую скопировать путь и имя из свойств файла cmake-gui.exe. Обладатели TotalCommander могут получить полный путь нажав Ctrl+Shift+Enter над cmake-gui.exe и скопировав из командной строки. Окно открыто?
2. Указать путь до исходников OpenCV в первой строке
3. Придумать путь куда CMake будет складывать компилированное, собранное из исходников - не важно куда, лишь бы не в Qt и не в исходники OpenCV. Это во вторую строку. Пусть, для примера d:/Qt/opencvmingw
4. Задать Grupping, Advanced
5. Configure - первый
6. В диалоге с выбором генератора для проекта выбрать MinGW Makefiles. Давим Finish. Для любопытных, в отличие от "инструкций" задавать компилятор не нужно, спасибо такому хитрому способу запуска cmake-gui.exe. Само всё найдётся
7. Ждёёёёём. Много всего на красном
8. Далее начинается магия. Надо, чтобы :

  * `WITH_QT = 1`
  * `WITH_OPENGL = 1` 
  * `WITH_IPP = 0`
  * `WITH_DSHOW = 0`
  * `BUILD_TESTS = 0`.
  * Для ленивых в `CMAKE_INSTALL_PREFIX` указать путь C:\Qt\opencv300. Сюда будут скопированы готовые к использованию библиотеки и заголовочные файлы.

9. Configure - второй. Ждать меньше. Красного тоже мало. Там как раз то, что должно быть найдено для Qt
10. Задать `CMAKE_BUILD_TYPE` теперь это выпадающее меню. Выбрать то, что нужно. А нужно, в итоге, оба варианта.
11. Configure - третий.
12. Generate.
12. Копируем путь из второй строки cmake-gui, переходим в консоль. Командой `cd /d d:/Qt/opencvmingw` переключаемся на проект для компиляции. Ключ /d позволяет сменить диск одновременно с папкой
14. `mingw32-make`. Ждёёёёёёёёёёёёёём.
14. `mingw32-make install`. Можно объединить `mingw32-make && mingw32-make install` в одной строке
15. повторить с задания `CMAKE_BUILD_TYPE` для другого варианта
16. По-желанию задать `BUILD_SHARED_LIBS = 0` и повторить

Теперь в папке из `CMAKE_INSTALL_PREFIX` находится всё необходимое

За `BUILD_TESTS = 0` отдельное спасибо [Nuzhny](http://rsdn.ru/account/info/32351) за то, что вспомнил.
`WITH_IPP = 0` уже чаще встречается и кое-где объясняется почему. `WITH_DSHOW = 0` пришлось добавить из-за ошибки в

    sources\modules\videoio\src\cap_dshow.cpp:2182:41: error:
    'sprintf_instead_use_StringCbPrintfA_or_StringCchPrintfA' was not declared in this scope

## Сборка OpenCV 2.4.11

С ней всё проще, действия аналогичные сборке 3.0.0, кроме настроек. Надо задать
  * `WITH_QT = 1`
  * `WITH_OPENGL = 1` 

и всё.